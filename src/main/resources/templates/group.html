<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	lang="es">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<th:block th:replace="fragments/head :: head"></th:block>
	
	<!-- Put additional css and js sources -->
	<link rel="stylesheet" type="text/css" href="/css/style.css">    
    <link rel="stylesheet" type="text/css" href="/css/style_index.css"/>
    
	
    <!-- datatables-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
    
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/sl-1.2.6/datatables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.2.7/css/select.dataTables.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/select/1.2.7/css/select.dataTables.min.css"></script>
    
    <script src="/js/moment.min.js"></script>
    <script type="text/javascript" src="/js/parser.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    <script type="text/javascript" src="/js/file.js"></script>
    <script type="text/javascript" src="/js/tag.js"></script>
  

    
    <title>M3 - MultiMedia Manager</title>
</head>

<body> 
        
    <nav th:replace="fragments/nav :: nav"></nav>
    
    <div class="conatiner mt-4">

        <div class="row">
            <div class="col-10 panel mx-auto">
                <div class="row">
                    <div class="col-3 border-right d-flex flex-column align-items-center files-panel">

                        <div class="d-flex flex-column align-items-center pb-2 pt-2">
                       	 	<h3 class="text-nowrap pr-4"><i class="material-icons ">perm_identity</i>Members</h3>
                            <form id="tagSearchForm" class="center-content searchForm mb-2 px-3 w-100">
                                <input id="tagSearchInput" class="form-control" type="search" placeholder="Search a member" aria-label="Search">
                                <button class="btn button-search" type="submit"><i class="material-icons center-content">search</i></button>
                            </form> 
                        </div>
                        <button id="btn-add-member" type="button" class="btn button d-flex align-items-center justify-content-center mb-3" data-toggle="modal" data-target="#modalAddMember">
					  		<i class="material-icons mr-2">person_add</i>
                          	<span>Add Member</span>
						</button>
                        <ul class="list-group list-group-flush w-100">                       
                            <li th:each="member : ${group.users}" class="list-group-item py-0 d-flex justify-content-between align-items-center list-tags">
                                <div class="d-flex align-items-center ">
                                    <!-- <i class="material-icons icon-tag mr-2">local_offer</i>-->
                                    <i class="material-icons icon-tag mr-2">bookmark</i>
                                    <a class="remove-link-style " th:href="@{/user/profile?userId=__${session.u.id}__}" th:text="${member.user.name}"></a>
                                </div>
                                <button class="btn no-bck" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="material-icons color-icon">menu</i></button>
                                <div class="dropdown-menu">
                                	
                                    
                                    <a class="dropdown-item  " href="#" data-toggle="modal" ><i class="material-icons mr-2 color-icon">delete_outline</i>Delete</a>
                                </div>
                            </li>
                        </ul>
                        
                        
                        <!-- Modal Add Member-->
						<div class="modal fade" id="modalAddMember" tabindex="-1" role="dialog" aria-hidden="true">
						  	<div class="modal-dialog" role="document">
						    	<div class="modal-content">
						      		<div class="modal-header">
						        		<h5 class="modal-title" id="modalNewTagLabel">Add new members</h5>
								        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
								          <span aria-hidden="true">&times;</span>
								        </button>
						     		</div>
									 <div class="modal-body px-5">
										 
											<ul class="list-group list-group-flush" th:if="${friends != null && friends.size() > 0}">
												<li class=" d-flex flex-row" th:each=" friend : ${friends}">
													<label class="friendPicker">
														<input type="checkbox" th:value="${friend.id}" name="members-check">
														<span class="friendPicker">
															<img class="profile-image" th:src="${friend.avatar}" th:if="${friend.avatar.contains('custom') == false}">
															<img class="profile-image" th:src="@{/user/avatar/{id}(id=${friend.id})}" th:if="${friend.avatar.contains('custom') == true}">
															<span class="d-flex flex-column align-items-center mr-3">
																<span class="link profile-name name" th:text="${friend.name + ' ' + friend.lastName}"></span>
																<span class="nick text-center" th:text="${'@'+friend.nickname}"></span>
															</span>
														</span>
													</label>
												</li>
											</ul>
			
											<div
												class="d-flex flex-column justify-content-center align-items-center pt-4 pb-3 px-4"
												th:if="${friends == null || friends.size() == 0}">
												<span>You haven't got any friends yet</span> <span><i
													class="far fa-frown"></i></span>
											</div>
										
									</div>
						      		 
					      			<div class="modal-footer">						      	
							        	<button type="button" class="btn button-second" data-dismiss="modal">Cancel</button>
							        	<button id="btn-add-members" form="new-tag-form" type="submit" class="btn button">Add members</button>
						  	      	</div>
						    	</div>
						  	</div>
						</div>
                        
                        
            
                        
                        
                        <!-- Modal Delete Tag-->
						<div th:each="tag : ${tags}" class="modal fade" th:attr="id=${'modalDelete' + tag.id}" tabindex="-1" role="dialog" aria-labelledby="modalColor" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
								        <h5 class="modal-title" id="exampleModalLabel" >Delete tag </h5>
								        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
								          <span aria-hidden="true">&times;</span>
								        </button>
								    </div>
								    <div class="modal-body">
								    	<form method="POST" th:action="@{/tag/deleteTag}">
								        	<div class="form-group">
						            			<label for="recipient-name" class="col-form-label" th:text="${'Are you sure you want to delete the tag ' + tag.name + '?' }"> </label>
						            			<input type="hidden" name="idTag" th:value="${tag.id}">
						          		  	</div>

									        <div class="modal-footer">						      	
										    	<button type="button" class="btn button-second" data-dismiss="modal">Cancel</button>
										       	<button type="submit" class="btn button">Delete tag</button>
									  	    </div>
								        </form>
								    </div>
								 </div>
							</div>
						</div>
								
								
                    </div>

                    <div class="col-6">
                    
                        <div id="folderView" class="row justify-content-center px-3 collapse multi-collapse show">
                        	<nav class="d-flex justify-content-between align-items-center border-bottom" aria-label="breadcrumb">                         
                                 <h2 id="title-name-group" th:text="${group.name}"></h2>
                                <div class="d-flex flex-column align-items-end">                              
		                            <form id="fileSearchForm" class="center-content searchForm mb-2 px-3">
		                                <input id="fileSearchInput" class="form-control" type="search" placeholder="Search a file" aria-label="Search">
		                                <button class="btn button-search" type="submit"><i class="material-icons center-content">search</i></button>
		                            </form>                        
		                        </div>
                                
                           	</nav>
                           
                           	<div class="panel-select-all-and-options center-content">
                           		<input type="checkbox" id="select-all-files">
                           		<div class="pl-2" >
	                               	<button type="button" data-toggle="tooltip" data-placement="bottom" title="Share" class="btn button-second "><i class="material-icons center-content">share</i></button>
                            		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Download" class="btn button-second "><i class="material-icons center-content">archive</i></button>
                            		<button class="btn button-second" data-toggle="modal" data-target="#modalDeleteFiles"><i class="material-icons center-content">delete</i></button>
                           		</div>
                           	</div>
                           
                           	<div class="panel-grid-files " >
                           	
                           		<div th:each="file : ${files}" class="panel-grid-files-element pb-3  my-2 droptarget dragtarget" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragStartFileToPlaylist(event)" draggable="true" th:attr="data-file-id=${file.id}" > 
                            	
                               		<div class=" file-icon-checkbox p-1 ml-4 ">
                                	
                                   		<input type ="checkbox" th:value="${file.id}" name="file-check" class="mr-4 file-checkbox">       
                                    	<a href="#" class="remove-link-style mr-3 icon-type" th:attr="data-mimetype=${file.mimetype}"> 
	                                        <i th:if="${#strings.contains(file.mimetype, 'text')}" class="material-icons folder  color-icon " > insert_drive_file</i>
	                                        <i th:if="${#strings.contains(file.mimetype, T(es.ucm.fdi.iw.model.FileType).Audio.keyName)}" class="material-icons folder  color-icon " >music_note</i>
	                                        <i th:if="${#strings.contains(file.mimetype, T(es.ucm.fdi.iw.model.FileType).Image.keyName)}" class="material-icons folder  color-icon " >photo</i>
	                                        <i th:if="${#strings.contains(file.mimetype, T(es.ucm.fdi.iw.model.FileType).Video.keyName)}" class="material-icons folder  color-icon " >videocam</i>
                                    	</a>
	                                    <!--  
	                                    <script th:inline="javascript">
						                 	window.addEventListener('load', () => {
						                 		document.querySelector("#metadata" + [[${file.id}]]).innerText = JSON.parse([[${file.metadata}]]).name;						                 		
						                 	});
	                        			</script>
	                        			-->
	                        			<div class="file-name" >
	                                       <a th:href="@{/file/show/{id}(id=${file.id})}" class="remove-link-style mr-5 dragtarget" th:text="${file.name}" th:attr="id = ${'metadata' + file.id}, data-file-id=${file.id}" ondragstart="dragStartFileToPlaylist(event)" draggable="true"></a>  
	                                    </div> 
							     	</div>
							       
									<div class="center-content mt-1">
										<div class="tags-style" th:each="tag : ${file.tags}" th:attr="style=${'background-color:' + tag.color}">
											<i class="material-icons mr-1" th:if="${tag.playlist != null && tag.playlist}">playlist_play</i>
											<span th:text="${tag.name}"></span>
											<button type="button" class="remove-tag-from-file-button" th:attr="data-file-id=${file.id}, data-tag-id=${tag.id}">x</button>	
										</div>
									</div>
                                	<div class="dropdown">
										<button class="btn button-options-dropdown dropdown-toggle center-content mr-5" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
											<i class="material-icons">more_vert</i>
										</button>
										
								    	<div th:attr="id=${'fileOptionButtons' + file.id}" class=" pl-2 dropdown-menu" aria-labelledby="dropdownMenuButton">
		                            		<a class="dropdown-item playable" href="#" th:if="${#strings.contains(file.mimetype, 'text')}" th:attr="data-fileId=${file.id}"> 
		                                        <i class="mr-2 material-icons center-content color-icon">insert_drive_file</i>Show
	                                    	</a>
	                                    	<a class="dropdown-item playable" href="#" th:if="${#strings.contains(file.mimetype, T(es.ucm.fdi.iw.model.FileType).Audio.keyName)}" th:attr="data-fileId=${file.id}"> 
		                                        <i class="mr-2 material-icons center-content color-icon">music_note</i>Play
	                                    	</a>
	                                    	<a class="dropdown-item playable" href="#" th:if="${#strings.contains(file.mimetype, T(es.ucm.fdi.iw.model.FileType).Image.keyName)}" th:attr="data-fileId=${file.id}"> 
		                                        <i class="mr-2 material-icons center-content color-icon">photo</i>Show
	                                    	</a>
	                                    	<a class="dropdown-item playable" href="#" th:if="${#strings.contains(file.mimetype, T(es.ucm.fdi.iw.model.FileType).Video.keyName)}" th:attr="data-fileId=${file.id}"> 
		                                        <i  class="mr-2 material-icons center-content color-icon">videocam</i>Play
	                                    	</a>
		                            		<a class="dropdown-item" href="#" data-toggle="modal" th:attr="data-target=${'#modalEditNameFile' + file.id}">
		                            			<i class=" mr-2 material-icons center-content color-icon">edit</i>Edit
		                            		</a>
		                            		<a class="dropdown-item" href="#" data-toggle="modal" th:attr="data-target=${'#modalViewAllTag' + file.id}">
		                            			<i class=" mr-2 material-icons center-content color-icon icon-tag">bookmark</i>Tags
		                            		</a>
		                               		<a class="dropdown-item" href="#" data-toggle="modal">
		                               			<i class=" mr-2 material-icons center-content color-icon">share</i>Share
		                               		</a>
		                            		<a class="dropdown-item" href="#" data-toggle="modal" th:attr="data-target=${'#modalAddToPlaylist' + file.id}">
		                            			<i class=" mr-2 material-icons center-content color-icon">playlist_add</i>Add to a Playlist
		                            		</a>
		                            		<a class="dropdown-item" th:href="@{${'/file/download/' + file.id}}" target="_blank">
		                            			<i class="color-icon mr-2 material-icons center-content">archive</i>Download
		                            		</a>
		                            		<a class="dropdown-item" href="#" data-toggle="modal" th:attr="data-target=${'#modalDeleteFile' + file.id}">
		                            			<i class="mr-2 material-icons color-icon center-content">delete</i>Delete
		                            		</a>
	                            		</div>
							   		</div>                                
                               
                            	</div>
                            
                          	</div>
                        </div>
                      
                       	<div class="file-upload-wrapper border-upload-file mt-5 pb-4">  
                        	<h3 class="center-content mt-4 pt-3 "><i class="material-icons folder color-icon">backup</i></h3>
                    		<div class="custom-file mb-5 pb-5 ">
	                        	<form th:if="${session.u != null}" method="POST" th:action="@{/file/upload}" enctype="multipart/form-data" >
	                        		<input  type="file" class="custom-file-input file-upload input-file-now" id="customFile" name="file"/>
	                        		<label class="custom-file-label" for="customFile">Drag and drop a file here or click to browse</label>
	                        		
	                        		<button type="submit" id="button-upload-file" class="btn button d-flex align-items-center mt-3 mx-auto"><i class="material-icons mr-2">unarchive</i>Upload File</button>
	                        		<input type="hidden" th:value="@{session.u.id}" name="userId" id="userId">
	                        		<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	                        		<input type="hidden" th:if="${tagsHierarchy != null && !#lists.isEmpty(tagsHierarchy)}" name="currentTagId" th:value="${tagsHierarchy[#lists.size(tagsHierarchy) - 1].id}" />
	                        		<input type="hidden" th:if="${(tagsHierarchy == null || #lists.isEmpty(tagsHierarchy)) && parentTag != null}" name="currentTagId" th:value="${parentTag.id}" />
	                        		<input type="hidden" th:if="${parentTag == null && tagsHierarchy == null}" th:name="currentTagId" th:value="null" />
	                        	</form>
                			</div>
                       	</div>
                       
                        						
								
					  
								
						 
								
						 
						 
					</div>
								
                    
                
                	<div class="col-3 border-left d-flex flex-column align-items-center files-panel">
                		 <div class="d-flex flex-column align-items-center pb-2 pt-2">
                       	 	<h3 class="text-nowrap pr-4 center-content"><i class="material-icons">chat</i>Chat</h3>
                            <form id="tagSearchForm" class="center-content searchForm mb-2 px-3 w-100">
                                <input id="tagSearchInput" class="form-control" type="search" placeholder="Search a message" aria-label="Search">
                                <button class="btn button-search" type="submit"><i class="material-icons center-content">search</i></button>
                            </form> 
                        </div>
                        
                	</div>
                
                </div>
            </div>
        </div>

        <div class="row mt-4 justify-content-center">
            <a th:href="@{/user/history}" class="btn button d-flex"><i class="material-icons mr-2">history</i>View history</a>
        </div>
        
       
    </div>



		
</body>
</html>
    