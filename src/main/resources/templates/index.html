<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	lang="es">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<th:block th:replace="fragments/head :: head"></th:block>
	
	<!-- Put additional css and js sources -->
	<link rel="stylesheet" type="text/css" href="/css/style.css">    
    <link rel="stylesheet" type="text/css" href="/css/style_index.css"/>
	
    <!-- datatables-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
    
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/sl-1.2.6/datatables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.2.7/css/select.dataTables.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/select/1.2.7/css/select.dataTables.min.css"></script>
    
    <script type="text/javascript" src="/js/index.js"></script>
    <script type="text/javascript" src="/js/file.js"></script>

    
    <title>M3 - MultiMedia Manager</title>
</head>

<body> 
        
    <nav th:replace="fragments/nav :: nav"></nav>
    
    <div class="conatiner mt-4">

        <div class="row">
            <div class="col-10 panel mx-auto">
                <div class="row">
                    <div class="col-3 border-right d-flex flex-column justify-content-center">
                        <div class="d-flex flex-column align-items-center pb-2 border-bottom files-left-panel">
                            <form class="form-inline center-content searchForm mb-2">
                                <input class="form-control" type="search" placeholder="Search a tag" aria-label="Search">
                                <button class="btn button button-search" type="submit"><i class="material-icons center-content">search</i></button>
                            </form>
                        
                           
                        </div>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item py-0 d-flex justify-content-between align-items-center">
                                
                                <button type="button" class="btn button-second mt-auto d-flex align-items-center justify-content-center" data-toggle="modal" data-target="#exampleModal">
						  <i class="material-icons mr-2">add</i>
                            <span>Add New Tag</span>
						</button>
                            </li>                            
                            
                            <li th:each="tag : ${tags}" class="list-group-item py-0 d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <!-- <i class="material-icons icon-tag mr-2">local_offer</i>-->
                                    <i th:attr="style=${'color:' + tag.color}" class="material-icons icon-tag mr-2">bookmark</i>
                                    <span th:text="${tag.name}"></span>
                                </div>
                                <button class="btn no-bck" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="material-icons">menu</i></button>
                                <div class="dropdown-menu">
                                    <a class="dropdown-item" href="#" data-toggle="modal" th:attr="data-target=${'#modalEdit' + tag.id}"><i class="material-icons mr-2">edit</i>Edit</a>
                                    <a class="dropdown-item" href="#" data-toggle="modal" th:attr="data-target=${'#modalDelete' + tag.id}"><i class="material-icons mr-2">delete_outline</i>Delete</a>
                                </div>
                            </li>
                        </ul>
                        
                        
                        	<!-- Modal Edit Tag-->
								<div th:each="tag : ${tags}" class="modal fade" th:attr="id=${'modalEdit' + tag.id}" tabindex="-1" role="dialog" aria-labelledby="modalColor" aria-hidden="true">
								  <div class="modal-dialog" role="document">
								    <div class="modal-content">
								      <div class="modal-header">
								        <h5 class="modal-title" id="exampleModalLabel" th:text="${'Modify color of the tag ' + tag.name}"></h5>
								        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
								          <span aria-hidden="true">&times;</span>
								        </button>
								      </div>
								      <div class="modal-body">
								      	<form method="POST" action="#" th:action="@{/file/modifyTag}">
								          <div class="form-group">
						            		<label for="recipient-name" class="col-form-label">Introduce the new name of the tag:</label>
						            		<input type="text" class="form-control" id="recipient-name" name="tagName" th:value="${tag.name}">
						          		  </div>
								           
								           <div class="form-group">
								            <label for="recipient-name" class="col-form-label">Choose a color:</label>
								            <input type="color"  id="recipient-name" name="colorTag" th:value="${tag.color}">
								            <input type="hidden"  th:value="${tag.id}" name="idTag">
								          </div>
								           
					
								          <div class="modal-footer">						      	
									        <button type="button" class="btn button-second" data-dismiss="modal">Cancel</button>
									        <button type="submit" class="btn button">Save changes</button>
								  	      </div>
								        </form>
								      </div>
								      
								    </div>
								  </div>
								</div>
                        
                        
                            
                                <!-- Modal Delete Tag-->
								<div th:each="tag : ${tags}" class="modal fade" th:attr="id=${'modalDelete' + tag.id}" tabindex="-1" role="dialog" aria-labelledby="modalColor" aria-hidden="true">
								  <div class="modal-dialog" role="document">
								    <div class="modal-content">
								      <div class="modal-header">
								        <h5 class="modal-title" id="exampleModalLabel" >Delete tag </h5>
								        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
								          <span aria-hidden="true">&times;</span>
								        </button>
								      </div>
								      <div class="modal-body">
								      	<form method="POST" action="#" th:action="@{/file/deleteTag}">
								          <div class="form-group">
						            		<label for="recipient-name" class="col-form-label" th:text="${'Are you sure you want to delete the tag ' + tag.name + '?' }"> </label>
						            		<input type="hidden" name="idTag" th:value="${tag.id}">
						          		  </div>

								          <div class="modal-footer">						      	
									        <button type="button" class="btn button-second" data-dismiss="modal">Cancel</button>
									        <button type="submit" class="btn button">I'm sure</button>
								  	      </div>
								        </form>
								      </div>
								      
								    </div>
								  </div>
								</div>
									
									
                               
                        
                        <!-- Button trigger modal -->
						<!-- <button type="button" class="btn button-second mt-auto d-flex align-items-center justify-content-center" data-toggle="modal" data-target="#exampleModal">
						  <i class="material-icons mr-2">add</i>
                            <span>Add New Tag</span>
						</button>-->
						
						<!-- Modal NewTag-->
						<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
						  <div class="modal-dialog" role="document">
						    <div class="modal-content">
						      <div class="modal-header">
						        <h5 class="modal-title" id="exampleModalLabel">Add new tag</h5>
						        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
						          <span aria-hidden="true">&times;</span>
						        </button>
						      </div>
						      <div class="modal-body">
						      	<form method="POST" action="#" th:action="@{/file/newTag}">
						          <div class="form-group">
						            <label for="recipient-name" class="col-form-label">Introduce the name of the new tag:</label>
						            <input type="text" class="form-control" id="recipient-name" name="tagName">
						          </div>
						          <div class="form-group">
						            <label for="exampleFormControlSelect1">Nest the tag in:</label>
									  <select class="form-control" id="exampleFormControlSelect1" name="parentId">
									  	<option></option>
									 	<option th:each="tag : ${tags}" th:value="${tag.id}" th:text="${tag.name}">Option</option>
									  </select>
						          </div>
						          <div class="modal-footer">						      	
							        <button type="button" class="btn button-second" data-dismiss="modal">Cancel</button>
							        <button type="submit" class="btn button">Create tag</button>
						  	      </div>
						        </form>
						      </div>
						      
						    </div>
						  </div>
						</div>
                        
                        
                        
                    </div>

                    <div class="col-9">
                        <div class="row align-items-center justify-content-between mb-2 px-3">
                       
						<a class="d-flex files-link" href="#">
                                <span class="title-section">My Files</span>
                                <i class="material-icons title-section my-auto ml-3">folder_open</i>
                            </a>
                            
                            
                        	<form th:if="${session.u != null}" method="POST" th:action="@{/user/{id}/file/(id=${session.u.id})}" enctype="multipart/form-data" >
                        		<input type="file" name="file"/>
                        		<!-- <input type="hidden" th:name="${_csrf.parameterName)" th:value="$(_csrf.token)"/>-->
                        		<button type="submit" id="button-upload-file" class="btn button d-flex align-items-center" style="height: 40px;"><i class="material-icons mr-2">unarchive</i>Upload</button>
                        		<input type="hidden" th:value="@{session.u.id}" name="userId" id="userId">
                        	</form>
                        	
                        	
                            
                           <!--  <div class="btn-group btn-group-toggle" data-toggle="buttons">
                                <button id="view-list" class="btn button-second" data-toggle="collapse" data-target=".multi-collapse"  aria-expanded="true" aria-controls="fileTable-container folderView">
                                    <input type="radio" name="options" id="option1" autocomplete="off" checked>
                                    <i class="material-icons center-content">view_list</i>
                                </button>
                                <button id="view-files" class="btn button-second active" data-toggle="collapse" data-target=".multi-collapse"  aria-expanded="false" aria-controls="fileTable-container folderView">
                                    <input type="radio" name="options" id="option2" autocomplete="off" checked>
                                    <i class="material-icons center-content">view_module</i>
                                </button>
                            </div> -->
                        </div>
                    
                      <!--   <div id="fileTable-container" class="collapse multi-collapse">
                            <table id="fileTable" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Tipo</th>
                                        <th>Tamaï¿½o</th>
                                        <th>Opc</th>
                                    </tr>
                                </thead>
                                <tbody>     
                                    <tr>
                                        <td>Imagen 1</td>
                                        <td>Imagen (jpg)</td>
                                        <td>2 MB</td>
                                        <td>
                                            <button type="button" class="btn dropdown-toggle ml-3" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" href="#"><i class="material-icons mr-2">share</i>Share</a>
                                                <a class="dropdown-item" href="#"><i class="material-icons mr-2">edit</i>Modify</a>
                                                <a class="dropdown-item" href="#"><i class="material-icons mr-2">open_with</i>Move</a>
                                                <a class="dropdown-item" href="#"><i class="material-icons mr-2">file_copy</i>Copy</a>
                                                <a class="dropdown-item" href="#"><i class="material-icons mr-2">delete_outline</i>Delete</a>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div> -->

                        <div id="folderView" class="row justify-content-center px-3 collapse multi-collapse show ">
                            <nav class="d-flex justify-content-between align-items-center border-bottom" aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item"><a href="#">Library</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Data</li>
                                </ol>
                                <!--
                                    <button class="btn button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="material-icons">brightness_low</i></button>
                                    <div class="dropdown-menu dropdown-menu-left">
                                        <a class="dropdown-item" href="#"><i class="material-icons mr-2">edit</i>Modify</a>
                                    </div>
                                -->
                                <button id="edit-folder-view" class="btn button"><i class="material-icons center-content">edit</i></button>
                                <button id="delete-files" class="btn button-second"><i class="material-icons center-content">delete</i></button>
                            </nav>
                           
                           
                           <div class="panel-grid-files" >
                            <div th:each="file : ${files}" class="panel-grid-files-element pb-3  my-2 "> 
                            	<div th:attr="id=${'fileOptionButtons' + file.id}" class="panel-buttons-options visibility-hidden pt-2 pl-2">
                            		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Edit" class="btn button "><i class="material-icons center-content">edit</i></button>
                            		<button type="button" data-toggle="tooltip" data-placement="bottom" title="Share" class="btn button "><i class="material-icons center-content">share</i></button>
                            	
                            	</div>
                                <div class=" file-icon-checkbox p-1">
                                   <input type ="checkbox" th:value="${file.id}" name="file-check" class="mr-4 file-checkbox">       
                                    <a href="#" class="remove-link-style"><i class="material-icons folder folder-icon">folder</i></a>
                                    <script th:inline="javascript">
                							
					                	var metadataJSON = JSON.parse([[${file.metadata}]]);
					                 	window.addEventListener('load', () => {
					                 		const e = document.querySelector("#metadata" + [[${file.id}]]);
					                 		e.innerText = metadataJSON.name;						                 		
					                 		 
					                 	});
                        			</script>
							     </div>
							     <div class="file-name">
                                    <a href="#"  class="remove-link-style" th:attr="id = ${'metadata' + file.id}"></a>  
                                 </div>                                    
                               
                            </div>
                           </div>
                        </div>

                        <div id="action-button-container" class="row pt-2 mx-1 d-none">
                            <div class="d-flex flex-column w-100">
                                <span class="border-bottom">Operations over selected items</span>
                                <div class="d-flex flex-row justify-content-around pt-3 w-100">
                                    <button id="share-selected" class="btn button d-flex flex-row align-items-center"><i class="material-icons mr-2">share</i>Share</button>
                                    <button id="move-selected" class="btn button d-flex flex-row align-items-center"><i class="material-icons mr-2">open_with</i>Move</button>
                                    <button id="copy-selected" class="btn button d-flex flex-row align-items-center"><i class="material-icons mr-2">file_copy</i>Copy</button>
                                    <button id="delete-selected" class="btn button d-flex flex-row align-items-center"><i class="material-icons mr-2">delete</i>Delete</button>
                                    <button id="save-changes" class="btn button-second d-flex flex-row align-items-center"><i class="material-icons mr-2">save</i>Save changes</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4 justify-content-center">
            <a th:href="@{/user/history}" class="btn button d-flex"><i class="material-icons mr-2">history</i>View history</a>
        </div>
        
       
    </div>



		
</body>
</html>
    